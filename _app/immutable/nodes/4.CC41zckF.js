import{s as me,d as Z,i as ge,b as ue,f as fe,h as xe,j as ye}from"../chunks/B6S3n0LM.js";import{S as we,i as Ee,d as Ce,t as Me,a as Se,m as Te,e as ke,b as Re}from"../chunks/AETkSAWP.js";import{P as _e}from"../chunks/Bra1f3A-.js";const Xe=!0,Fe=Object.freeze(Object.defineProperty({__proto__:null,prerender:Xe},Symbol.toStringTag,{value:"Module"}));function Ye(W){let S,m,n;return m=new _e({props:{sketch:W[0],style:"position:absolute; top:0; left:0;"}}),{c(){S=ye("div"),Re(m.$$.fragment),this.h()},l(e){S=fe(e,"DIV",{class:!0});var Y=xe(S);ke(m.$$.fragment,Y),Y.forEach(Z),this.h()},h(){ue(S,"class","viz-container svelte-14msw2v")},m(e,Y){ge(e,S,Y),Te(m,S,null),n=!0},p(e,[Y]){const H={};Y&1&&(H.sketch=e[0]),m.$set(H)},i(e){n||(Se(m.$$.fragment,e),n=!0)},o(e){Me(m.$$.fragment,e),n=!1},d(e){e&&Z(S),Ce(m)}}}function Ne(W,S,m){let n=e=>{const ee=.18000000000000002,$=100*.9,O=.01*.9,te=.05,ne=1,V=8*.9,b=1e3,U={},A=new Map;let Q=2,D=[],y={x:0,y:0},u=1,B=!1,j=0,G=0,L=0,I=1,i,a;const F=new Map;let _={x:0,y:0},z={left:0,right:0,top:0,bottom:0},p,q,K,J=[];function se(r,s,h){const T=`${r}_${s}_${h}`;if(A.has(T))return A.get(T);const c=e.createGraphics(40*.9,40*.9);c.colorMode(e.HSB),c.textFont("courier"),c.textAlign(e.CENTER,e.CENTER),c.textSize(h);const N=Math.max(c.textWidth(s),4),R=2*.9,t=2*.9;return c.noStroke(),c.fill(U[r]||e.color(60,8,57)),c.rectMode(e.CENTER),c.rect(c.width/2,c.height/2,N+R,h+t),c.fill(0,0,0),c.text(s,c.width/2,c.height/2),A.set(T,c),c}e.preload=()=>{e.dataTable=e.loadTable("parsed.csv","csv","header")},e.setup=()=>{var v;e.createCanvas(e.windowWidth,e.windowHeight),e.colorMode(e.HSB),e.textAlign(e.CENTER,e.CENTER),e.textSize(8.1),e.frameRate(30);const r=e.dataTable.getRows().map(o=>{const d=o.get("ExtractedDate")||o.get("Date"),[f,M,x]=d.split("."),k=new Date(+x,M-1,+f).getTime(),w=o.get("Text");let E;try{E=JSON.parse(o.get("KeywordMatch").replace(/'/g,'"'))}catch{E=o.get("KeywordMatch").split(/[,;]\s*/)}const C=[];return E.forEach(X=>{const P=w.match(new RegExp(`([^\\.]*${X}[^\\.]*)`,"i"));P&&C.push({kw:X,s:P[1].trim()})}),{date:k,sents:C}}).sort((o,d)=>o.date-d.date);if(!r.length)return;p=((v=r[1])==null?void 0:v.date)||r[0].date,q=r.at(-1).date,K=q-p;const s=Math.max(e.width*Q,1400),h=Math.max(e.height*Q,1e3);console.log(s,h);const T=h/3*.9,c=800*.9;_={x:s/2,y:h/2},z={left:0,right:s,top:0,bottom:h},i=e.createGraphics(s,h),i.colorMode(e.HSB),i.textAlign(e.CENTER,e.CENTER),i.textFont("courier"),i.textSize(11.700000000000001),i.background(0),a=e.createGraphics(s,h),a.colorMode(e.HSB),a.textAlign(e.CENTER,e.CENTER),a.textFont("courier"),J=[...new Set(r.map(o=>new Date(o.date).getFullYear()))].sort((o,d)=>o-d).map(o=>{const d=r.filter(M=>new Date(M.date).getFullYear()===o),f=d.reduce((M,x)=>M+(x.date-p)/K,0)/d.length;return{year:o,avgT:f}});const R=1,t=s-c,l=[...new Set(r.flatMap(o=>o.sents.map(d=>d.kw)))];l.forEach((o,d)=>{let f=Math.round(d*290/Math.max(l.length-1,1)+60)%360,M=0,x=Math.round(d*290/Math.max(l.length-1,1)+60)%360;U[o]=e.color(f,M,x)}),D=[];const g=T+30*.9;I=e.random([.1,.2,.3,.4,.5,.8,.9,1]),r.forEach(o=>{const d=(o.date-p)/K,f=R+d*(t-R),M=g,x=Math.floor(d*b);o.sents.forEach(({kw:k,s:w})=>{const E=Math.ceil(w.length*(V/7.2)),C=e.createVector(e.random(-I,I),1).normalize();D.push({kw:k,nodes:[e.createVector(f,M)],sentence:w,maxSteps:E,grown:0,frameCount:0,startFrame:x,dir0:C,pathLength:0,distArr:[0],lastPlacedCharIndex:-1,finished:!1})})}),u=e.height/z.bottom*1,u=1,y={x:0,y:0},m(0,n.timelineX0=R,n),m(0,n.timelineX1=t,n),m(0,n.yTimeline=g,n),m(0,n.rightDataMargin=c,n),m(0,n.w=s,n),m(0,n.h=h,n),m(0,n.marginY=T,n)},e.draw=()=>{F.clear(),e.frameCount%60===0&&(i.noStroke(),i.fill(0,0,0,.05),i.rect(0,0,i.width,i.height)),D.forEach(t=>t.nodes.forEach(l=>{const g=`${Math.floor(l.x/$)},${Math.floor(l.y/$)}`;F.has(g)||F.set(g,[]),F.get(g).push(l)})),D.forEach(t=>{if(t.finished||L<t.startFrame||(t.frameCount++,t.frameCount%ne!==0||t.grown>=t.maxSteps))return;const l=t.nodes[t.nodes.length-1];let g=t.dir0.copy();const[v,o]=oe(l).split(",").map(Number);for(let k=-1;k<=1;k++)for(let w=-1;w<=1;w++)(F.get(`${v+k},${o+w}`)||[]).forEach(E=>{const C=l.dist(E);C>0&&C<18&&g.add(e.createVector(l.x-E.x,l.y-E.y).normalize().mult(ee))});g.normalize();const d=e.noise(l.x*O,l.y*O,L*te);g.rotate(e.map(d,0,1,-e.QUARTER_PI*.6,e.QUARTER_PI*.6));const f=e.Vector.add(l,e.Vector.mult(g,7.2));f.x=e.constrain(f.x,z.left+9,z.right-9),f.y=e.constrain(f.y,z.top+9,z.bottom-9),t.nodes.push(f),t.grown++;const M=l.dist(f);t.pathLength+=M,t.distArr.push(t.pathLength);let x=t.lastPlacedCharIndex+1;for(;x<t.sentence.length&&(x+.5)*V<t.pathLength;){const k=(x+.5)*V,w=t.distArr.findIndex(E=>E>=k);if(w>0){const E=t.distArr[w-1],C=t.nodes[w-1],X=t.nodes[w],P=(k-E)/X.dist(C),ce=e.lerp(C.x,X.x,P),re=e.lerp(C.y,X.y,P),ie=e.atan2(X.y-C.y,X.x-C.x),le=t.sentence[x],he=18/2,de=se(t.kw,le,he);i.push(),i.translate(ce,re),i.rotate(ie),i.imageMode(e.CENTER),i.image(de,0,-7.2),i.pop(),t.lastPlacedCharIndex=x,x++}else break}t.grown>=t.maxSteps&&(t.finished=!0)}),L++;const r=Math.min(L/b,1),s=n.timelineX0,h=n.timelineX1,T=_.x,c=s+r*(h-s);!B&&u>=.3&&(y.x=-(c-T)*u,y.y=200*u),a.clear(),a.stroke(0,0,255),a.strokeWeight(1.8),a.line(s,n.yTimeline,h,n.yTimeline),a.line(s,n.h,h,n.h),J.forEach(({year:t,avgT:l})=>{const g=s+l*(h-s),v=n.yTimeline-32*.9;a.noStroke(),a.fill(0,0,255),a.textSize(16.2),a.text(t,g,v);const o=v+22*.9;a.push(),a.stroke(0,0,255),a.strokeWeight(1.8),a.drawingContext.setLineDash([16.2,9]),a.line(g,o,g,n.h),a.drawingContext.setLineDash([]),a.pop()});const N=s+r*(h-s);if(a.stroke(0,0,255),a.strokeWeight(2.7),a.line(s,n.yTimeline-1.8,N,n.yTimeline-1.8),D.length&&D.every(t=>t.finished)){ae();return}e.background(0),e.push(),e.translate(e.width/2,e.height/2),e.scale(u),e.translate(y.x,y.y),e.image(i,-_.x,-_.y),e.image(a,-_.x,-_.y),e.pop()};function oe(r){return`${Math.floor(r.x/$)},${Math.floor(r.y/$)}`}function ae(){I=e.random([.1,.2,.3,.4,.5,1,2,3,4,5]),L=0,i.clear(),i.background(0),A.clear(),e.setup()}e.mousePressed=()=>{B=!0,j=e.mouseX,G=e.mouseY},e.mouseReleased=()=>{B=!1},e.mouseDragged=()=>{if(B){const r=(e.mouseX-j)/u,s=(e.mouseY-G)/u;y.x+=r,y.y+=s,j=e.mouseX,G=e.mouseY}},e.mouseWheel=r=>{const s=r.deltaY<0?1.05:.9523809523809523,h=Math.min(L/b,1),T=n.timelineX0+h*(n.timelineX1-n.timelineX0),c=n.yTimeline,N=e.width/2,R=e.height/2,t=N+(T-_.x+y.x)*u,l=R+(c-_.y+y.y)*u;return u=e.constrain(u*s,.5,1),y.x=(N-t)/u+y.x,y.y=(R-l)/u+y.y,!1},e.windowResized=()=>{e.resizeCanvas(e.windowWidth,e.windowHeight)}};return[n]}class Pe extends we{constructor(S){super(),Ee(this,S,Ne,Ye,me,{})}}export{Pe as component,Fe as universal};
