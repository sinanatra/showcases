import{s as st,n as ot,d as Z,i as at,b as rt,f as lt,h as ct,j as it}from"../chunks/jds0Hg19.js";import{S as ht,i as dt,d as mt,t as ut,a as gt,m as ft,e as xt,b as wt}from"../chunks/BqteK-Fr.js";import{P as Et}from"../chunks/BnHmvMf4.js";const St=!0,Rt=Object.freeze(Object.defineProperty({__proto__:null,prerender:St},Symbol.toStringTag,{value:"Module"}));function yt(p){let m,t,_;return t=new Et({props:{sketch:p[0],style:"position:absolute; top:0; left:0;"}}),{c(){m=it("div"),wt(t.$$.fragment),this.h()},l(u){m=lt(u,"DIV",{class:!0});var R=ct(m);xt(t.$$.fragment,R),R.forEach(Z),this.h()},h(){rt(m,"class","viz-container svelte-14msw2v")},m(u,R){at(u,m,R),ft(t,m,null),_=!0},p:ot,i(u){_||(gt(t.$$.fragment,u),_=!0)},o(u){ut(t.$$.fragment,u),_=!1},d(u){u&&Z(m),mt(t)}}}function Ct(p){return[t=>{const z=5.6000000000000005,G=.015,B=600,O={};let y=[],T={x:0,y:0},L=1,N=!1,V=0,H=0,M=0,s,i;const I=new Map;let d,C,A=[],$,j,Y,W,v,F,U=[],D=1;t.preload=()=>{t.dataTable=t.loadTable("all_merged.csv","csv","header")},t.setup=()=>{t.createCanvas(t.windowWidth,t.windowHeight),t.colorMode(t.HSB),t.textFont("monospace"),t.textSize(10.4),t.textAlign(t.CENTER,t.CENTER),D=t.random([.1,.2,.3,.4,.5,.8,.9,1]);const a=t.dataTable.getRows().map(n=>{const r=n.get("ExtractedDate")||n.get("Date"),[e,l,o]=r.split("."),c=new Date(+o,l-1,+e).getTime(),X=n.get("Text");let h;try{h=JSON.parse(n.get("KeywordMatch").replace(/'/g,'"'))}catch{h=n.get("KeywordMatch").split(/[,;]\s*/)}const f=[];return h.forEach(w=>{const E=X.match(new RegExp(`([^\\.]*${w}[^\\.]*)`,"i"));E&&f.push({kw:w,s:E[1].trim()})}),{date:c,sents:f}}).sort((n,r)=>n.date-r.date);if(!a.length)return;$=a[0].date,j=a.at(-1).date,W=j-$,Y=Math.max(t.width,t.height)*.8*.8,v=Math.max(t.width*2,Y*2+32),F=Math.max(t.height*2,Y*2+32),d={x:v/2,y:F/2},C={left:0,right:v,top:0,bottom:F},s=t.createGraphics(v,F),s.colorMode(t.HSB),s.textFont("monospace"),s.textSize(10.4),s.background(0),A=a.map((n,r)=>{const e=(n.date-$)/W,l=1*.8,o=e*Y+l,c=t.random(t.TWO_PI);return{x:d.x+Math.cos(c)*o,y:d.y+Math.sin(c)*o,row:n,angle:c,radius:o,t:e}}),U=[...new Set(A.map(n=>new Date(n.row.date).getFullYear()))].sort((n,r)=>n-r).map(n=>{const r=A.filter(o=>new Date(o.row.date).getFullYear()===n),e=r.reduce((o,c)=>o+c.angle,0)/r.length,l=r.reduce((o,c)=>o+c.radius,0)/r.length;return{year:n,avgAngle:e,avgRadius:l}}),i=t.createGraphics(v,F),y=A.map((n,r)=>{var e;return{nodes:[t.createVector(n.x,n.y)],hue:t.map(r,0,A.length-1,0,360),sentence:n.row.sents.length?n.row.sents[0].s:"",maxSteps:Math.ceil((((e=n.row.sents[0])==null?void 0:e.s.length)||20)*(z/6.4)),grown:0,attractor:n,pathLength:0,distArr:[0],lastPlacedCharIndex:-1,finished:!1,startFrame:Math.floor(n.t*B),frameCount:0,direction:t.createVector(Math.cos(n.angle),Math.sin(n.angle)).rotate(t.random(-D,D)),keyword:n.row.sents.length?n.row.sents[0].kw:null}});const g=[...new Set(a.flatMap(n=>n.sents.map(r=>r.kw)))];g.forEach((n,r)=>{let e=Math.round(r*290/Math.max(g.length-1,1)+60)%360,l=0,o=Math.round(r*290/Math.max(g.length-1,1)+60)%360;O[n]=t.color(e,l,o)})},t.draw=()=>{I.clear(),t.frameCount%60===0&&(s.noStroke(),s.fill(0,0,0,.05),s.rect(0,0,s.width,s.height)),y.forEach(e=>e.nodes.forEach(l=>{const o=`${Math.floor(l.x/72)},${Math.floor(l.y/72)}`;I.has(o)||I.set(o,[]),I.get(o).push(l)})),y.forEach((e,l)=>{if(e.finished||M<e.startFrame||e.frameCount++%1)return;const o=e.nodes[e.nodes.length-1];let c=e.direction.copy();y.forEach((w,E)=>{if(l!==E&&!w.finished){const k=w.nodes[w.nodes.length-1],S=o.dist(k);S>0&&S<16&&c.add(t.Vector.sub(o,k).normalize().mult(.1))}});const X=t.noise(o.x*G,o.y*G,M*.006);c.rotate(t.map(X,0,1,-t.QUARTER_PI/2,t.QUARTER_PI/2)),c.normalize();const h=t.Vector.add(o,t.Vector.mult(c,6.4));if(h.x=t.constrain(h.x,19.200000000000003,C.right-19.200000000000003),h.y=t.constrain(h.y,19.200000000000003,C.bottom-19.200000000000003),h.x<C.left+8||h.x>C.right-8||h.y<C.top+8||h.y>C.bottom-8){e.finished=!0;return}e.nodes.push(h),e.grown++,e.pathLength+=6.4,e.distArr.push(e.pathLength);let f=e.lastPlacedCharIndex+1;for(;f<e.sentence.length&&(f+.5)*z<e.pathLength;){const w=(f+.5)*z,E=e.distArr.findIndex(k=>k>=w);if(E>0){const k=e.distArr[E-1],S=e.nodes[E-1],P=e.nodes[E],b=(w-k)/P.dist(S),K=t.lerp(S.x,P.x,b),Q=t.lerp(S.y,P.y,b),q=t.atan2(P.y-S.y,P.x-S.x);s.push(),s.translate(K,Q),s.rotate(q),s.textSize(8);const et=Math.max(s.textWidth(e.sentence[f]),4),nt=s.textAscent()+s.textDescent(),J=.4*.8;s.noStroke(),s.fill(O[e.keyword]||t.color(60,8,57)),s.rectMode(t.CENTER),s.rect(0,-6.4,et+J*2,nt+J*2),s.pop(),s.push(),s.translate(K,Q),s.rotate(q),s.textAlign(t.CENTER,t.CENTER),s.textFont("monospace"),s.textSize(8),s.fill(0),s.text(e.sentence[f],0,-6.4),s.pop(),e.lastPlacedCharIndex=f,f++}else break}}),M++;const a=$+M/B*W,x=new Date(a).getFullYear();i.clear(),i.textFont("monospace");const g=d.y,n=10*.8;if(i.textAlign(i.RIGHT,i.RIGHT),U.forEach(({year:e,avgRadius:l})=>{const o=e===x;i.stroke(255,o?255:100),i.strokeWeight(o?1:.5),i.noFill(),i.ellipse(d.x,d.y,l*2,l*2);const c=d.x-l-n;i.noStroke(),i.fill(o?255:200),i.textSize(o?9.600000000000001:5.6000000000000005),i.text(e,c,g)}),y.length&&y.every(e=>e.finished)||M%600===0){tt();return}t.background(0),t.push(),t.translate(t.width/2,t.height/2),t.scale(L),t.translate(T.x,T.y),t.image(s,-d.x,-d.y),t.image(i,-d.x,-d.y),t.pop()};function tt(){M=0,s.clear(),s.background(0),y=A.map((a,x)=>{var g;return{nodes:[t.createVector(a.x,a.y)],hue:t.map(x,0,A.length-1,0,360),sentence:a.row.sents.length?a.row.sents[0].s:"",maxSteps:Math.ceil((((g=a.row.sents[0])==null?void 0:g.s.length)||20)*(z/6.4)),grown:0,attractor:a,pathLength:0,distArr:[0],lastPlacedCharIndex:-1,finished:!1,startFrame:Math.floor(a.t*B),frameCount:0,direction:t.createVector(Math.cos(a.angle),Math.sin(a.angle)).rotate(t.random(-D,D)),keyword:a.row.sents.length?a.row.sents[0].kw:null}})}t.mousePressed=()=>{N=!0,V=t.mouseX,H=t.mouseY},t.mouseReleased=()=>{N=!1},t.mouseDragged=()=>{if(N){const a=(t.mouseX-V)/L,x=(t.mouseY-H)/L;T.x+=a,T.y+=x,V=t.mouseX,H=t.mouseY}},t.mouseWheel=a=>{const x=a.deltaY<0?1.05:.9523809523809523,g=t.mouseX-t.width/2;return T.x-=g/L*(x-1),L=t.constrain(L*x,.2,8),!1},t.windowResized=()=>t.resizeCanvas(t.windowWidth,t.windowHeight)}]}class Tt extends ht{constructor(m){super(),dt(this,m,Ct,yt,st,{})}}export{Tt as component,Rt as universal};
