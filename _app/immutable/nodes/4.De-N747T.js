import{s as de,d as J,i as me,b as ge,f as ue,h as fe,j as xe}from"../chunks/B6S3n0LM.js";import{S as Ee,i as Ce,d as Se,t as ye,a as we,m as Le,e as Ae,b as Me}from"../chunks/AETkSAWP.js";import{P as Te}from"../chunks/Bra1f3A-.js";const ke=!0,De=Object.freeze(Object.defineProperty({__proto__:null,prerender:ke},Symbol.toStringTag,{value:"Module"}));function Re(W){let L,m,n;return m=new Te({props:{sketch:W[0],style:"position:absolute; top:0; left:0;"}}),{c(){L=xe("div"),Me(m.$$.fragment),this.h()},l(e){L=ue(e,"DIV",{class:!0});var _=fe(L);Ae(m.$$.fragment,_),_.forEach(J),this.h()},h(){ge(L,"class","viz-container svelte-14msw2v")},m(e,_){me(e,L,_),Le(m,L,null),n=!0},p(e,[_]){const H={};_&1&&(H.sketch=e[0]),m.$set(H)},i(e){n||(we(m.$$.fragment,e),n=!0)},o(e){ye(m.$$.fragment,e),n=!1},d(e){e&&J(L),Se(m)}}}function _e(W,L,m){let n=e=>{const Z=.16000000000000003,F=100*.8,O=.01*.8,ee=.05,te=1,V=8*.8,b=1e3,U={},P=new Map;let Y=[],E={x:0,y:0},u=1,p=!1,j=0,G=0,v=0,B=1,c,r;const $=new Map;let k={x:0,y:0},D={left:0,right:0,top:0,bottom:0},I,Q,K,q=[];function ne(i,s,h){const M=`${i}_${s}_${h}`;if(P.has(M))return P.get(M);const a=e.createGraphics(40*.8,40*.8);a.colorMode(e.HSB),a.textFont("courier"),a.textAlign(e.CENTER,e.CENTER),a.textSize(h);const X=Math.max(a.textWidth(s),4),T=2*.8,t=2*.8;return a.noStroke(),a.fill(U[i]||e.color(60,8,57)),a.rectMode(e.CENTER),a.rect(a.width/2,a.height/2,X+T,h+t),a.fill(0,0,0),a.text(s,a.width/2,a.height/2),P.set(M,a),a}e.preload=()=>{e.dataTable=e.loadTable("parsed.csv","csv","header")},e.setup=()=>{var N;e.createCanvas(e.windowWidth,e.windowHeight),e.colorMode(e.HSB),e.textAlign(e.CENTER,e.CENTER),e.textSize(9.600000000000001),e.frameRate(30);const i=e.dataTable.getRows().map(o=>{const d=o.get("ExtractedDate")||o.get("Date"),[f,w,x]=d.split("."),A=new Date(+x,w-1,+f).getTime(),C=o.get("Text");let S;try{S=JSON.parse(o.get("KeywordMatch").replace(/'/g,'"'))}catch{S=o.get("KeywordMatch").split(/[,;]\s*/)}const y=[];return S.forEach(R=>{const z=C.match(new RegExp(`([^\\.]*${R}[^\\.]*)`,"i"));z&&y.push({kw:R,s:z[1].trim()})}),{date:A,sents:y}}).sort((o,d)=>o.date-d.date);if(!i.length)return;I=((N=i[1])==null?void 0:N.date)||i[0].date,Q=i.at(-1).date,K=Q-I;const s=2800,h=2500;console.log(s,h);const M=h/3*.8,a=800*.8;k={x:s/2,y:h/2},D={left:0,right:s,top:0,bottom:h},c=e.createGraphics(s,h),c.colorMode(e.HSB),c.textAlign(e.CENTER,e.CENTER),c.textFont("courier"),c.textSize(10.4),c.background(0),r=e.createGraphics(s,h),r.colorMode(e.HSB),r.textAlign(e.CENTER,e.CENTER),r.textFont("courier"),q=[...new Set(i.map(o=>new Date(o.date).getFullYear()))].sort((o,d)=>o-d).map(o=>{const d=i.filter(w=>new Date(w.date).getFullYear()===o),f=d.reduce((w,x)=>w+(x.date-I)/K,0)/d.length;return{year:o,avgT:f}});const T=1,t=s-a,l=[...new Set(i.flatMap(o=>o.sents.map(d=>d.kw)))];l.forEach((o,d)=>{let f=Math.round(d*290/Math.max(l.length-1,1)+60)%360,w=0,x=Math.round(d*290/Math.max(l.length-1,1)+60)%360;U[o]=e.color(f,w,x)}),Y=[];const g=M+30*.8;B=e.random([.1,.2,.3,.4,.5,.8,.9,1]),i.forEach(o=>{const d=(o.date-I)/K,f=T+d*(t-T),w=g,x=Math.floor(d*b);o.sents.forEach(({kw:A,s:C})=>{const S=Math.ceil(C.length*(V/6.4)),y=e.createVector(e.random(-B,B),1).normalize();Y.push({kw:A,nodes:[e.createVector(f,w)],sentence:C,maxSteps:S,grown:0,frameCount:0,startFrame:x,dir0:y,pathLength:0,distArr:[0],lastPlacedCharIndex:-1,finished:!1})})}),u=e.height/D.bottom*1,u=1,E={x:0,y:0},m(0,n.timelineX0=T,n),m(0,n.timelineX1=t,n),m(0,n.yTimeline=g,n),m(0,n.rightDataMargin=a,n),m(0,n.w=s,n),m(0,n.h=h,n)},e.draw=()=>{$.clear(),e.frameCount%60===0&&(c.noStroke(),c.fill(0,0,0,.01),c.rect(0,0,c.width,c.height)),Y.forEach(t=>t.nodes.forEach(l=>{const g=`${Math.floor(l.x/F)},${Math.floor(l.y/F)}`;$.has(g)||$.set(g,[]),$.get(g).push(l)})),Y.forEach(t=>{if(t.finished||v<t.startFrame||(t.frameCount++,t.frameCount%te!==0||t.grown>=t.maxSteps))return;const l=t.nodes[t.nodes.length-1];let g=t.dir0.copy();const[N,o]=oe(l).split(",").map(Number);for(let A=-1;A<=1;A++)for(let C=-1;C<=1;C++)($.get(`${N+A},${o+C}`)||[]).forEach(S=>{const y=l.dist(S);y>0&&y<16&&g.add(e.createVector(l.x-S.x,l.y-S.y).normalize().mult(Z))});g.normalize();const d=e.noise(l.x*O,l.y*O,v*ee);g.rotate(e.map(d,0,1,-e.QUARTER_PI*.6,e.QUARTER_PI*.6));const f=e.Vector.add(l,e.Vector.mult(g,6.4));f.x=e.constrain(f.x,D.left+8,D.right-8),f.y=e.constrain(f.y,D.top+8,D.bottom-8),t.nodes.push(f),t.grown++;const w=l.dist(f);t.pathLength+=w,t.distArr.push(t.pathLength);let x=t.lastPlacedCharIndex+1;for(;x<t.sentence.length&&(x+.5)*V<t.pathLength;){const A=(x+.5)*V,C=t.distArr.findIndex(S=>S>=A);if(C>0){const S=t.distArr[C-1],y=t.nodes[C-1],R=t.nodes[C],z=(A-S)/R.dist(y),ae=e.lerp(y.x,R.x,z),re=e.lerp(y.y,R.y,z),ie=e.atan2(R.y-y.y,R.x-y.x),ce=t.sentence[x],le=16/2,he=ne(t.kw,ce,le);c.push(),c.translate(ae,re),c.rotate(ie),c.imageMode(e.CENTER),c.image(he,0,-6.4),c.pop(),t.lastPlacedCharIndex=x,x++}else break}t.grown>=t.maxSteps&&(t.finished=!0)}),v++;const i=Math.min(v/b,1),s=n.timelineX0,h=n.timelineX1,M=k.x,a=s+i*(h-s);!p&&u>=.3&&(E.x=-(a-M)*u,E.y=200*u),r.clear(),r.stroke(0,0,255),r.strokeWeight(1.6),r.line(s,n.yTimeline,h,n.yTimeline),q.forEach(({year:t,avgT:l})=>{const g=s+l*(h-s),N=n.yTimeline-32*.8;r.noStroke(),r.fill(0,0,255),r.textSize(14.4),r.text(t,g,N);const o=N+22*.8;r.push(),r.stroke(0,0,255),r.strokeWeight(1.6),r.drawingContext.setLineDash([14.4,8]),r.line(g,o,g,n.h),r.drawingContext.setLineDash([]),r.pop()});const X=s+i*(h-s);if(r.stroke(0,0,255),r.strokeWeight(2.4000000000000004),r.line(s,n.yTimeline-1.6,X,n.yTimeline-1.6),Y.length&&Y.every(t=>t.finished)){se();return}e.background(0),e.push(),e.translate(e.width/2,e.height/2),e.scale(u),e.translate(E.x,E.y),e.image(c,-k.x,-k.y),e.image(r,-k.x,-k.y),e.pop()};function oe(i){return`${Math.floor(i.x/F)},${Math.floor(i.y/F)}`}function se(){B=e.random([.1,.2,.3,.4,.5,1,2,3,4,5]),v=0,c.clear(),c.background(0),P.clear(),e.setup()}e.mousePressed=()=>{p=!0,j=e.mouseX,G=e.mouseY},e.mouseReleased=()=>{p=!1},e.mouseDragged=()=>{if(p){const i=(e.mouseX-j)/u,s=(e.mouseY-G)/u;E.x+=i,E.y+=s,j=e.mouseX,G=e.mouseY}},e.mouseWheel=i=>{const s=i.deltaY<0?1.05:.9523809523809523,h=Math.min(v/b,1),M=n.timelineX0+h*(n.timelineX1-n.timelineX0),a=n.yTimeline,X=e.width/2,T=e.height/2,t=X+(M-k.x+E.x)*u,l=T+(a-k.y+E.y)*u;return u=e.constrain(u*s,.5,1),E.x=(X-t)/u+E.x,E.y=(T-l)/u+E.y,!1},e.windowResized=()=>{e.resizeCanvas(e.windowWidth,e.windowHeight)}};return[n]}class $e extends Ee{constructor(L){super(),Ce(this,L,_e,Re,de,{})}}export{$e as component,De as universal};
