import{s as st,n as ot,d as q,i as at,b as rt,f as ct,h as it,j as lt}from"../chunks/jds0Hg19.js";import{S as dt,i as ht,d as mt,t as ut,a as gt,m as ft,e as xt,b as Et}from"../chunks/BqteK-Fr.js";import{P as St}from"../chunks/BnHmvMf4.js";const wt=!0,_t=Object.freeze(Object.defineProperty({__proto__:null,prerender:wt},Symbol.toStringTag,{value:"Module"}));function Ct(D){let f,t,z;return t=new St({props:{sketch:D[0],style:"position:absolute; top:0; left:0;"}}),{c(){f=lt("div"),Et(t.$$.fragment),this.h()},l(x){f=ct(x,"DIV",{class:!0});var C=it(f);xt(t.$$.fragment,C),C.forEach(q),this.h()},h(){rt(f,"class","viz-container svelte-14msw2v")},m(x,C){at(x,f,C),ft(t,f,null),z=!0},p:ot,i(x){z||(gt(t.$$.fragment,x),z=!0)},o(x){ut(t.$$.fragment,x),z=!1},d(x){x&&q(f),mt(t)}}}function yt(D){return[t=>{const C=9.600000000000001,J=.1,W=90*.4,R=7*.4,b=.015,I=300;let y=[],k={x:0,y:0},L=1,N=!1,V=0,p=0,T=0,s,i;const v=new Map;let m,A,M=[],P,H,$,B,F,Y,O=[];t.preload=()=>{t.dataTable=t.loadTable("all_merged.csv","csv","header")},t.setup=()=>{t.createCanvas(t.windowWidth,t.windowHeight),t.colorMode(t.HSB),t.textFont("monospace"),t.textSize(5.2),t.textAlign(t.CENTER,t.CENTER);const a=t.dataTable.getRows().map(n=>{const e=n.get("ExtractedDate")||n.get("Date"),[r,o,c]=e.split("."),E=new Date(+c,o-1,+r).getTime(),l=n.get("Text");let d;try{d=JSON.parse(n.get("KeywordMatch").replace(/'/g,'"'))}catch{d=n.get("KeywordMatch").split(/[,;]\s*/)}const u=[];return d.forEach(g=>{const S=l.match(new RegExp(`([^\\.]*${g}[^\\.]*)`,"i"));S&&u.push({kw:g,s:S[1].trim()})}),{date:E,sents:u}}).sort((n,e)=>n.date-e.date);if(!a.length)return;[...new Set(a.flatMap(n=>n.sents.map(e=>e.kw)))],P=a[0].date,H=a.at(-1).date,B=H-P,$=Math.max(t.width,t.height)*.8*.4,F=Math.max(t.width*2,$*2+16),Y=Math.max(t.height*2,$*2+16),m={x:F/2,y:0},A={left:0,right:F,top:0,bottom:Y},s=t.createGraphics(F,Y),s.colorMode(t.HSB),s.textFont("monospace"),s.textSize(5.2),s.background(0),M=a.map((n,e)=>{const r=(n.date-P)/B,o=r*$+120,c=t.random(t.PI);return{x:m.x+Math.cos(c)*o,y:m.y+Math.sin(c)*o,row:n,angle:c,radius:o,t:r}});const h=[...new Set(M.map(n=>new Date(n.row.date).getFullYear()))];h.sort((n,e)=>n-e),O=h.map(n=>{const e=M.filter(c=>new Date(c.row.date).getFullYear()===n),r=e.reduce((c,E)=>c+E.angle,0)/e.length,o=e.reduce((c,E)=>c+E.radius,0)/e.length;return{year:n,avgAngle:r,avgRadius:o}}),i=t.createGraphics(F,Y),y=M.map((n,e)=>{var r;return{nodes:[t.createVector(n.x,n.y)],hue:t.map(e,0,M.length-1,0,360),sentence:n.row.sents.length?n.row.sents[0].s:"",maxSteps:Math.ceil((((r=n.row.sents[0])==null?void 0:r.s.length)||20)*(R/3.2)),grown:0,attractor:n,pathLength:0,distArr:[0],lastPlacedCharIndex:-1,finished:!1,startFrame:Math.floor(n.t*I),frameCount:0,direction:t.createVector(Math.cos(n.angle),Math.sin(n.angle)).rotate(t.random(-.6,.6))}})},t.draw=()=>{v.clear(),s.noStroke(),s.fill(0,0,0,.01),s.rect(0,0,s.width,s.height),y.forEach(e=>e.nodes.forEach(r=>{const o=`${Math.floor(r.x/W)},${Math.floor(r.y/W)}`;v.has(o)||v.set(o,[]),v.get(o).push(r)})),y.forEach((e,r)=>{if(e.finished||T<e.startFrame||e.frameCount++%1)return;const o=e.nodes[e.nodes.length-1];let c=e.direction.copy();y.forEach((u,g)=>{if(r!==g&&!u.finished){const S=u.nodes[u.nodes.length-1],w=o.dist(S);if(w>0&&w<C){const _=t.Vector.sub(o,S).normalize().mult(J);c.add(_)}}});const E=t.noise(o.x*b,o.y*b,T*.006);c.rotate(t.map(E,0,1,-t.QUARTER_PI/2,t.QUARTER_PI/2)),c.normalize();const l=t.Vector.add(o,t.Vector.mult(c,3.2));if(l.x=t.constrain(l.x,9.600000000000001,A.right-9.600000000000001),l.y=t.constrain(l.y,9.600000000000001,A.bottom-9.600000000000001),l.x<A.left+4||l.x>A.right-4||l.y<A.top+4||l.y>A.bottom-4){e.finished=!0;return}e.nodes.push(l),e.grown++,e.pathLength+=3.2,e.distArr.push(e.pathLength);let d=e.lastPlacedCharIndex+1;for(;d<e.sentence.length&&(d+.5)*R<e.pathLength;){const u=(d+.5)*R,g=e.distArr.findIndex(S=>S>=u);if(g>0){const S=e.distArr[g-1],w=e.nodes[g-1],_=e.nodes[g],j=(u-S)/_.dist(w),G=t.lerp(w.x,_.x,j),K=t.lerp(w.y,_.y,j),Q=t.atan2(_.y-w.y,_.x-w.x);s.push(),s.translate(G,K),s.rotate(Q);const U=e.sentence[d],tt=2*.4,et=2*.4,X=C/2;s.textSize(X);const nt=s.textWidth(U);s.noStroke(),s.fill(0,0,80,1),s.rectMode(t.CENTER),s.rect(0,-3.2,nt+tt,X+et),s.pop(),s.push(),s.translate(G,K),s.rotate(Q),s.textAlign(t.CENTER,t.CENTER),s.textFont("monospace"),s.textSize(X),s.fill(0,0,0),s.text(U,0,-3.2),s.pop(),e.lastPlacedCharIndex=d,d++}else break}}),T++;const a=P+T/I*B,h=new Date(a).getFullYear();if(i.clear(),i.textAlign(t.CENTER,t.CENTER),i.textFont("monospace"),O.forEach(({year:e,avgAngle:r,avgRadius:o})=>{const c=e===h,E=c?255:100,l=c?12*.4:7*.4,d=c?80*.4:60*.4;i.stroke(E),i.strokeWeight(.5),i.noFill(),i.arc(m.x,m.y,o*2,o*2,r-3,r+3),i.noStroke(),i.fill(255),i.textSize(l);const u=m.x+Math.cos(r)*(o+d),g=m.y+Math.sin(r)*(o+d);i.text(e,u,g)}),y.length&&y.every(e=>e.finished)||T%600===0){Z();return}t.background(0),t.push(),t.translate(t.width/2,0),t.scale(L),t.translate(k.x,k.y),t.image(s,-m.x,-m.y),t.image(i,-m.x,-m.y),t.pop()};function Z(){T=0,s.clear(),s.background(0),y=M.map((a,h)=>{var n;return{nodes:[t.createVector(a.x,a.y)],hue:t.map(h,0,M.length-1,0,360),sentence:a.row.sents.length?a.row.sents[0].s:"",maxSteps:Math.ceil((((n=a.row.sents[0])==null?void 0:n.s.length)||20)*(R/3.2)),grown:0,attractor:a,pathLength:0,distArr:[0],lastPlacedCharIndex:-1,finished:!1,startFrame:Math.floor(a.t*I),frameCount:0,direction:t.createVector(Math.cos(a.angle),Math.sin(a.angle)).rotate(t.random(-.6,.6))}})}t.mousePressed=()=>{N=!0,V=t.mouseX,p=t.mouseY},t.mouseReleased=()=>{N=!1},t.mouseDragged=()=>{if(N){const a=(t.mouseX-V)/L,h=(t.mouseY-p)/L;k.x+=a,k.y+=h,V=t.mouseX,p=t.mouseY}},t.mouseWheel=a=>{const h=a.deltaY<0?1.05:.9523809523809523,n=t.mouseX-t.width/2,e=t.mouseY-0;return k.x-=n/L*(h-1),k.y-=e/L*(h-1),L=t.constrain(L*h,.2,8),!1},t.windowResized=()=>{t.resizeCanvas(t.windowWidth,t.windowHeight)}}]}class kt extends dt{constructor(f){super(),ht(this,f,yt,Ct,st,{})}}export{kt as component,_t as universal};
