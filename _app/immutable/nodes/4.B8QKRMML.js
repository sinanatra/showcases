import{s as mt,d as Z,i as gt,b as ut,f as ft,h as xt,j as Et}from"../chunks/B6S3n0LM.js";import{S as Ct,i as St,d as yt,t as wt,a as Lt,m as At,e as Mt,b as Tt}from"../chunks/AETkSAWP.js";import{P as kt}from"../chunks/Bra1f3A-.js";const Rt=!0,$t=Object.freeze(Object.defineProperty({__proto__:null,prerender:Rt},Symbol.toStringTag,{value:"Module"}));function _t(W){let L,m,n;return m=new kt({props:{sketch:W[0],style:"position:absolute; top:0; left:0;"}}),{c(){L=Et("div"),Tt(m.$$.fragment),this.h()},l(t){L=ft(t,"DIV",{class:!0});var _=xt(L);Mt(m.$$.fragment,_),_.forEach(Z),this.h()},h(){ut(L,"class","viz-container svelte-14msw2v")},m(t,_){gt(t,L,_),At(m,L,null),n=!0},p(t,[_]){const H={};_&1&&(H.sketch=t[0]),m.$set(H)},i(t){n||(Lt(m.$$.fragment,t),n=!0)},o(t){wt(m.$$.fragment,t),n=!1},d(t){t&&Z(L),yt(m)}}}function Xt(W,L,m){let n=t=>{const tt=.16000000000000003,F=100*.8,O=.01*.8,et=.05,nt=1,V=8*.8,b=1e3,U={},P=new Map;let Q=2,Y=[],E={x:0,y:0},u=1,B=!1,j=0,G=0,v=0,I=1,c,r;const $=new Map;let k={x:0,y:0},D={left:0,right:0,top:0,bottom:0},p,q,K,J=[];function ot(i,s,h){const M=`${i}_${s}_${h}`;if(P.has(M))return P.get(M);const a=t.createGraphics(40*.8,40*.8);a.colorMode(t.HSB),a.textFont("courier"),a.textAlign(t.CENTER,t.CENTER),a.textSize(h);const X=Math.max(a.textWidth(s),4),T=2*.8,e=2*.8;return a.noStroke(),a.fill(U[i]||t.color(60,8,57)),a.rectMode(t.CENTER),a.rect(a.width/2,a.height/2,X+T,h+e),a.fill(0,0,0),a.text(s,a.width/2,a.height/2),P.set(M,a),a}t.preload=()=>{t.dataTable=t.loadTable("parsed.csv","csv","header")},t.setup=()=>{var N;t.createCanvas(t.windowWidth,t.windowHeight),t.colorMode(t.HSB),t.textAlign(t.CENTER,t.CENTER),t.textSize(9.600000000000001),t.frameRate(30);const i=t.dataTable.getRows().map(o=>{const d=o.get("ExtractedDate")||o.get("Date"),[f,w,x]=d.split("."),A=new Date(+x,w-1,+f).getTime(),C=o.get("Text");let S;try{S=JSON.parse(o.get("KeywordMatch").replace(/'/g,'"'))}catch{S=o.get("KeywordMatch").split(/[,;]\s*/)}const y=[];return S.forEach(R=>{const z=C.match(new RegExp(`([^\\.]*${R}[^\\.]*)`,"i"));z&&y.push({kw:R,s:z[1].trim()})}),{date:A,sents:y}}).sort((o,d)=>o.date-d.date);if(!i.length)return;p=((N=i[1])==null?void 0:N.date)||i[0].date,q=i.at(-1).date,K=q-p;const s=Math.max(t.width*Q,2200),h=Math.max(t.height*Q,2e3);console.log(s,h);const M=h/3*.8,a=800*.8;k={x:s/2,y:h/2},D={left:0,right:s,top:0,bottom:h},c=t.createGraphics(s,h),c.colorMode(t.HSB),c.textAlign(t.CENTER,t.CENTER),c.textFont("courier"),c.textSize(10.4),c.background(0),r=t.createGraphics(s,h),r.colorMode(t.HSB),r.textAlign(t.CENTER,t.CENTER),r.textFont("courier"),J=[...new Set(i.map(o=>new Date(o.date).getFullYear()))].sort((o,d)=>o-d).map(o=>{const d=i.filter(w=>new Date(w.date).getFullYear()===o),f=d.reduce((w,x)=>w+(x.date-p)/K,0)/d.length;return{year:o,avgT:f}});const T=1,e=s-a,l=[...new Set(i.flatMap(o=>o.sents.map(d=>d.kw)))];l.forEach((o,d)=>{let f=Math.round(d*290/Math.max(l.length-1,1)+60)%360,w=0,x=Math.round(d*290/Math.max(l.length-1,1)+60)%360;U[o]=t.color(f,w,x)}),Y=[];const g=M+30*.8;I=t.random([.1,.2,.3,.4,.5,.8,.9,1]),i.forEach(o=>{const d=(o.date-p)/K,f=T+d*(e-T),w=g,x=Math.floor(d*b);o.sents.forEach(({kw:A,s:C})=>{const S=Math.ceil(C.length*(V/6.4)),y=t.createVector(t.random(-I,I),1).normalize();Y.push({kw:A,nodes:[t.createVector(f,w)],sentence:C,maxSteps:S,grown:0,frameCount:0,startFrame:x,dir0:y,pathLength:0,distArr:[0],lastPlacedCharIndex:-1,finished:!1})})}),u=t.height/D.bottom*1,u=1,E={x:0,y:0},m(0,n.timelineX0=T,n),m(0,n.timelineX1=e,n),m(0,n.yTimeline=g,n),m(0,n.rightDataMargin=a,n),m(0,n.w=s,n),m(0,n.h=h,n)},t.draw=()=>{$.clear(),t.frameCount%60===0&&(c.noStroke(),c.fill(0,0,0,.01),c.rect(0,0,c.width,c.height)),Y.forEach(e=>e.nodes.forEach(l=>{const g=`${Math.floor(l.x/F)},${Math.floor(l.y/F)}`;$.has(g)||$.set(g,[]),$.get(g).push(l)})),Y.forEach(e=>{if(e.finished||v<e.startFrame||(e.frameCount++,e.frameCount%nt!==0||e.grown>=e.maxSteps))return;const l=e.nodes[e.nodes.length-1];let g=e.dir0.copy();const[N,o]=st(l).split(",").map(Number);for(let A=-1;A<=1;A++)for(let C=-1;C<=1;C++)($.get(`${N+A},${o+C}`)||[]).forEach(S=>{const y=l.dist(S);y>0&&y<16&&g.add(t.createVector(l.x-S.x,l.y-S.y).normalize().mult(tt))});g.normalize();const d=t.noise(l.x*O,l.y*O,v*et);g.rotate(t.map(d,0,1,-t.QUARTER_PI*.6,t.QUARTER_PI*.6));const f=t.Vector.add(l,t.Vector.mult(g,6.4));f.x=t.constrain(f.x,D.left+8,D.right-8),f.y=t.constrain(f.y,D.top+8,D.bottom-8),e.nodes.push(f),e.grown++;const w=l.dist(f);e.pathLength+=w,e.distArr.push(e.pathLength);let x=e.lastPlacedCharIndex+1;for(;x<e.sentence.length&&(x+.5)*V<e.pathLength;){const A=(x+.5)*V,C=e.distArr.findIndex(S=>S>=A);if(C>0){const S=e.distArr[C-1],y=e.nodes[C-1],R=e.nodes[C],z=(A-S)/R.dist(y),rt=t.lerp(y.x,R.x,z),it=t.lerp(y.y,R.y,z),ct=t.atan2(R.y-y.y,R.x-y.x),lt=e.sentence[x],ht=16/2,dt=ot(e.kw,lt,ht);c.push(),c.translate(rt,it),c.rotate(ct),c.imageMode(t.CENTER),c.image(dt,0,-6.4),c.pop(),e.lastPlacedCharIndex=x,x++}else break}e.grown>=e.maxSteps&&(e.finished=!0)}),v++;const i=Math.min(v/b,1),s=n.timelineX0,h=n.timelineX1,M=k.x,a=s+i*(h-s);!B&&u>=.3&&(E.x=-(a-M)*u,E.y=100*u),r.clear(),r.stroke(0,0,255),r.strokeWeight(1.6),r.line(s,n.yTimeline,h,n.yTimeline),J.forEach(({year:e,avgT:l})=>{const g=s+l*(h-s),N=n.yTimeline-32*.8;r.noStroke(),r.fill(0,0,255),r.textSize(14.4),r.text(e,g,N);const o=N+22*.8;r.push(),r.stroke(0,0,255),r.strokeWeight(1.6),r.drawingContext.setLineDash([14.4,8]),r.line(g,o,g,n.h),r.drawingContext.setLineDash([]),r.pop()});const X=s+i*(h-s);if(r.stroke(0,0,255),r.strokeWeight(2.4000000000000004),r.line(s,n.yTimeline-1.6,X,n.yTimeline-1.6),Y.length&&Y.every(e=>e.finished)){at();return}t.background(0),t.push(),t.translate(t.width/2,t.height/2),t.scale(u),t.translate(E.x,E.y),t.image(c,-k.x,-k.y),t.image(r,-k.x,-k.y),t.pop()};function st(i){return`${Math.floor(i.x/F)},${Math.floor(i.y/F)}`}function at(){I=t.random([.1,.2,.3,.4,.5,1,2,3,4,5]),v=0,c.clear(),c.background(0),P.clear(),t.setup()}t.mousePressed=()=>{B=!0,j=t.mouseX,G=t.mouseY},t.mouseReleased=()=>{B=!1},t.mouseDragged=()=>{if(B){const i=(t.mouseX-j)/u,s=(t.mouseY-G)/u;E.x+=i,E.y+=s,j=t.mouseX,G=t.mouseY}},t.mouseWheel=i=>{const s=i.deltaY<0?1.05:.9523809523809523,h=Math.min(v/b,1),M=n.timelineX0+h*(n.timelineX1-n.timelineX0),a=n.yTimeline,X=t.width/2,T=t.height/2,e=X+(M-k.x+E.x)*u,l=T+(a-k.y+E.y)*u;return u=t.constrain(u*s,.5,1),E.x=(X-e)/u+E.x,E.y=(T-l)/u+E.y,!1},t.windowResized=()=>{t.resizeCanvas(t.windowWidth,t.windowHeight)}};return[n]}class zt extends Ct{constructor(L){super(),St(this,L,Xt,_t,mt,{})}}export{zt as component,$t as universal};
