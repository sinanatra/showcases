import{s as mt,d as ot,i as ut,b as gt,f as ft,h as xt,j as Et}from"../chunks/B6S3n0LM.js";import{S as St,i as Ct,d as yt,t as wt,a as Lt,m as At,e as kt,b as Tt}from"../chunks/AETkSAWP.js";import{P as Mt}from"../chunks/Bra1f3A-.js";const Rt=!0,Dt=Object.freeze(Object.defineProperty({__proto__:null,prerender:Rt},Symbol.toStringTag,{value:"Module"}));function Xt(I){let w,h,o;return h=new Mt({props:{sketch:I[0],style:"position:absolute; top:0; left:0;"}}),{c(){w=Et("div"),Tt(h.$$.fragment),this.h()},l(t){w=ft(t,"DIV",{class:!0});var T=xt(w);kt(h.$$.fragment,T),T.forEach(ot),this.h()},h(){gt(w,"class","viz-container svelte-14msw2v")},m(t,T){ut(t,w,T),At(h,w,null),o=!0},p(t,[T]){const W={};T&1&&(W.sketch=t[0]),h.$set(W)},i(t){o||(Lt(h.$$.fragment,t),o=!0)},o(t){wt(h.$$.fragment,t),o=!1},d(t){t&&ot(w),yt(h)}}}function _t(I,w,h){let o=t=>{const st=.16000000000000003,p=100*.8,G=.01*.8,at=.05,rt=1,V=8*.8,H=1e3,Q={};let q=4,X=[],f={x:0,y:0},x=1,$=!1,b=0,j=0,_=0,v=1,n,a;const N=new Map;let k={x:0,y:0},z={left:0,right:0,top:0,bottom:0},B,J,K,Z=[];t.preload=()=>{t.dataTable=t.loadTable("parsed.csv","csv","header")},t.setup=()=>{var R;t.createCanvas(t.windowWidth,t.windowHeight),t.colorMode(t.HSB),t.textAlign(t.CENTER,t.CENTER),t.textSize(9.600000000000001),t.frameRate(30);const c=t.dataTable.getRows().map(s=>{const l=s.get("ExtractedDate")||s.get("Date"),[m,y,u]=l.split("."),L=new Date(+u,y-1,+m).getTime(),C=s.get("Text");let g;try{g=JSON.parse(s.get("KeywordMatch").replace(/'/g,'"'))}catch{g=s.get("KeywordMatch").split(/[,;]\s*/)}const S=[];return g.forEach(A=>{const P=C.match(new RegExp(`([^\\.]*${A}[^\\.]*)`,"i"));P&&S.push({kw:A,s:P[1].trim()})}),{date:L,sents:S}}).sort((s,l)=>s.date-l.date);if(!c.length)return;B=((R=c[1])==null?void 0:R.date)||c[0].date,J=c.at(-1).date,K=J-B;const i=Math.max(t.width*q,2200),E=Math.max(t.height*q,2e3),D=E/3*.8,Y=800*.8;k={x:i/2,y:E/2},z={left:0,right:i,top:0,bottom:E},n=t.createGraphics(i,E),n.colorMode(t.HSB),n.textAlign(t.CENTER,t.CENTER),n.textFont("courier"),n.textSize(10.4),n.background(0),a=t.createGraphics(i,E),a.colorMode(t.HSB),a.textAlign(t.CENTER,t.CENTER),a.textFont("courier"),Z=[...new Set(c.map(s=>new Date(s.date).getFullYear()))].sort((s,l)=>s-l).map(s=>{const l=c.filter(y=>new Date(y.date).getFullYear()===s),m=l.reduce((y,u)=>y+(u.date-B)/K,0)/l.length;return{year:s,avgT:m}});const M=1,e=i-Y,r=[...new Set(c.flatMap(s=>s.sents.map(l=>l.kw)))];r.forEach((s,l)=>{let m=Math.round(l*290/Math.max(r.length-1,1)+60)%360,y=0,u=Math.round(l*290/Math.max(r.length-1,1)+60)%360;Q[s]=t.color(m,y,u)}),X=[];const d=D+30*.8;v=t.random([.1,.2,.3,.4,.5,.8,.9,1]),console.log(v),c.forEach((s,l)=>{const m=(s.date-B)/K,y=M+m*(e-M),u=d,L=Math.floor(m*H);s.sents.forEach(({kw:C,s:g})=>{const S=Math.ceil(g.length*(V/6.4)),A=t.createVector(t.random(-v,v),1).normalize();X.push({kw:C,nodes:[t.createVector(y,u)],sentence:g,maxSteps:S,grown:0,frameCount:0,startFrame:L,dir0:A,pathLength:0,distArr:[0],lastPlacedCharIndex:-1,finished:!1})})}),x=t.height/z.bottom*1.5,f={x:0,y:0},h(0,o.timelineX0=M,o),h(0,o.timelineX1=e,o),h(0,o.yTimeline=d,o),h(0,o.rightDataMargin=Y,o),h(0,o.w=i,o),h(0,o.h=E,o)},t.draw=()=>{N.clear(),t.frameCount%60===0&&(n.noStroke(),n.fill(0,0,0,.01),n.rect(0,0,n.width,n.height)),X.forEach(e=>e.nodes.forEach(r=>{const d=`${Math.floor(r.x/p)},${Math.floor(r.y/p)}`;N.has(d)||N.set(d,[]),N.get(d).push(r)})),X.forEach(e=>{if(e.finished||_<e.startFrame||(e.frameCount++,e.frameCount%rt!==0||e.grown>=e.maxSteps))return;const r=e.nodes[e.nodes.length-1];let d=e.dir0.copy();const[R,s]=it(r).split(",").map(Number);for(let L=-1;L<=1;L++)for(let C=-1;C<=1;C++)(N.get(`${R+L},${s+C}`)||[]).forEach(g=>{const S=r.dist(g);S>0&&S<16&&d.add(t.createVector(r.x-g.x,r.y-g.y).normalize().mult(st))});d.normalize();const l=t.noise(r.x*G,r.y*G,_*at);d.rotate(t.map(l,0,1,-t.QUARTER_PI*.6,t.QUARTER_PI*.6));const m=t.Vector.add(r,t.Vector.mult(d,6.4));m.x=t.constrain(m.x,z.left+8,z.right-8),m.y=t.constrain(m.y,z.top+8,z.bottom-8),e.nodes.push(m),e.grown++;const y=r.dist(m);e.pathLength+=y,e.distArr.push(e.pathLength);let u=e.lastPlacedCharIndex+1;for(;u<e.sentence.length&&(u+.5)*V<e.pathLength;){const L=(u+.5)*V,C=e.distArr.findIndex(g=>g>=L);if(C>0){const g=e.distArr[C-1],S=e.nodes[C-1],A=e.nodes[C],P=(L-g)/A.dist(S),tt=t.lerp(S.x,A.x,P),et=t.lerp(S.y,A.y,P),nt=t.atan2(A.y-S.y,A.x-S.x);n.push(),n.translate(tt,et),n.rotate(nt);const O=e.sentence[u],lt=2*.8,ht=2*.8,U=16/2;n.textSize(U);const dt=n.textWidth(O)>3?n.textWidth(O):4;n.noStroke(),n.fill(Q[e.kw]||t.color(60,8,57)),n.rectMode(t.CENTER),n.rect(0,-6.4,dt+lt,U+ht),n.pop(),n.push(),n.translate(tt,et),n.rotate(nt),n.textAlign(t.CENTER,t.CENTER),n.textFont("courier"),n.textSize(U),n.fill(0,0,0),n.text(O,0,-6.4),n.pop(),e.lastPlacedCharIndex=u,u++}else break}e.grown>=e.maxSteps&&(e.finished=!0)}),_++;const c=Math.min(_/H,1),i=o.timelineX0,E=o.timelineX1,D=k.x,Y=i+c*(E-i);!$&&x>=.3&&(f.x=-(Y-D)*x,f.y=500*x),a.clear(),a.stroke(0,0,255),a.strokeWeight(1.6),a.line(i,o.yTimeline,E,o.yTimeline),Z.forEach(({year:e,avgT:r})=>{const d=i+r*(E-i),R=o.yTimeline-32*.8;a.noStroke(),a.fill(0,0,255),a.textSize(14.4),a.text(e,d,R);const s=R+22*.8;a.push(),a.stroke(0,0,255),a.strokeWeight(1.6),a.drawingContext.setLineDash([14.4,8]),a.line(d,s,d,o.h),a.drawingContext.setLineDash([]),a.pop()});const F=i+c*(E-i);if(a.stroke(0,0,255),a.strokeWeight(2.4000000000000004),a.line(i,o.yTimeline-1.6,F,o.yTimeline-1.6),X.length&&X.every(e=>e.finished)){ct();return}t.background(0),t.push(),t.translate(t.width/2,t.height/2),t.scale(x),t.translate(f.x,f.y),t.image(n,-k.x,-k.y),t.image(a,-k.x,-k.y),t.pop()};function it(c){return`${Math.floor(c.x/p)},${Math.floor(c.y/p)}`}function ct(){v=t.random([.1,.2,.3,.4,.5,1,2,3,4,5]),_=0,n.clear(),n.background(0),t.setup()}t.mousePressed=()=>{$=!0,b=t.mouseX,j=t.mouseY},t.mouseReleased=()=>{$=!1},t.mouseDragged=()=>{if($){const c=(t.mouseX-b)/x,i=(t.mouseY-j)/x;f.x+=c,f.y+=i,b=t.mouseX,j=t.mouseY}},t.mouseWheel=c=>{const i=c.deltaY<0?1.05:.9523809523809523,E=Math.min(_/H,1),D=o.timelineX0+E*(o.timelineX1-o.timelineX0),Y=o.yTimeline,F=t.width/2,M=t.height/2,e=F+(D-k.x+f.x)*x,r=M+(Y-k.y+f.y)*x;return x=t.constrain(x*i,.3,1),f.x=(F-e)/x+f.x,f.y=(M-r)/x+f.y,!1},t.windowResized=()=>{t.resizeCanvas(t.windowWidth,t.windowHeight)}};return[o]}class Ft extends St{constructor(w){super(),Ct(this,w,_t,Xt,mt,{})}}export{Ft as component,Dt as universal};
