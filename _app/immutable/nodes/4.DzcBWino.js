import{s as me,n as ae,d as B,p as Ye,i as Q,q as ze,G as De,b as fe,f as ue,h as ge,t as Fe,j as ye,w as Ae,y as Pe,v as be,x as Be}from"../chunks/7zwduY7e.js";import{S as xe,i as we,d as re,t as ce,a as ie,m as le,e as he,b as de}from"../chunks/D_8M7GTZ.js";import{P as Ie}from"../chunks/BP0KYbRm.js";import{r as J}from"../chunks/Bq54tBkh.js";const Le=!0,Ze=Object.freeze(Object.defineProperty({__proto__:null,prerender:Le},Symbol.toStringTag,{value:"Module"}));function Oe(N){let l,h=N[0]?"Stop Recording":"Start Recording",f,y,n;return{c(){l=ye("button"),f=Ae(h),this.h()},l(e){l=ue(e,"BUTTON",{class:!0});var x=ge(l);f=Fe(x,h),x.forEach(B),this.h()},h(){fe(l,"class","svelte-1fvae0v")},m(e,x){Q(e,l,x),ze(l,f),y||(n=De(l,"click",N[1]),y=!0)},p(e,[x]){x&1&&h!==(h=e[0]?"Stop Recording":"Start Recording")&&Ye(f,h)},i:ae,o:ae,d(e){e&&B(l),y=!1,n()}}}function We(N,l,h){let f;return Pe(N,J,n=>h(0,f=n)),[f,()=>J.update(n=>!n)]}class He extends xe{constructor(l){super(),we(this,l,We,Oe,me,{})}}function Ve(N){let l,h,f,y,n;return l=new He({}),y=new Ie({props:{sketch:N[0],style:"position:absolute; top:0; left:0;"}}),{c(){de(l.$$.fragment),h=Be(),f=ye("div"),de(y.$$.fragment),this.h()},l(e){he(l.$$.fragment,e),h=be(e),f=ue(e,"DIV",{class:!0});var x=ge(f);he(y.$$.fragment,x),x.forEach(B),this.h()},h(){fe(f,"class","viz-container svelte-14msw2v")},m(e,x){le(l,e,x),Q(e,h,x),Q(e,f,x),le(y,f,null),n=!0},p(e,[x]){const V={};x&1&&(V.sketch=e[0]),y.$set(V)},i(e){n||(ie(l.$$.fragment,e),ie(y.$$.fragment,e),n=!0)},o(e){ce(l.$$.fragment,e),ce(y.$$.fragment,e),n=!1},d(e){e&&(B(h),B(f)),re(l,e),re(y)}}}let Ge=2e3;function Ke(N,l,h){let f=!1,y=0,n=e=>{const Ee=.13999999999999999,I=100*.7,Z=.01*.7,Ce=.05,Se=1,G=8*.7,K=1e3,ee={},L=new Map;let te=2,D=[],R={x:0,y:0},C=1,O=!1,U=0,j=0,F=0,W=1,d,i;const P=new Map;let Y={x:0,y:0},A={left:0,right:0,top:0,bottom:0},H,ne,q,se=[];function _e(s,o,r){const T=`${s}_${o}_${r}`;if(L.has(T))return L.get(T);const a=e.createGraphics(40*.7,40*.7);a.colorMode(e.HSB),a.textFont("courier"),a.textAlign(e.CENTER,e.CENTER),a.textSize(r);const w=Math.max(a.textWidth(o),4),E=2*.7,t=2*.7;return a.noStroke(),a.fill(ee[s]||e.color(60,8,57)),a.rectMode(e.CENTER),a.rect(a.width/2,a.height/2,w+E,r+t),a.fill(0,0,0),a.text(o,a.width/2,a.height/2),L.set(T,a),a}e.preload=()=>{e.dataTable=e.loadTable("parsed.csv","csv","header")};function oe(s,o=300){if(!s)return"";if(s.length<=o)return s;let r=s.lastIndexOf(" ",o);return r===-1&&(r=o),s.slice(0,r)+"…"}function Me(s,o,r=300){if(!s||!o)return oe(s,r);const T=s.toLowerCase().indexOf(o.toLowerCase());if(T===-1)return oe(s,r);let a=Math.max(0,T-Math.floor((r-o.length)/2)),w=a+r;if(w>s.length&&(w=s.length,a=Math.max(0,w-r)),a>0){const t=s.lastIndexOf(" ",a);t!==-1&&(a=t+1)}if(w<s.length){const t=s.indexOf(" ",w);t!==-1&&(w=t)}let E=s.slice(a,w);return a>0&&(E="…"+E),w<s.length&&(E=E+"…"),E}e.setup=()=>{var z;e.createCanvas(e.windowWidth,e.windowHeight),e.colorMode(e.HSB),e.textAlign(e.CENTER,e.CENTER),e.textSize(9*.7),e.frameRate(30);const s=e.dataTable.getRows().map(c=>{const g=c.get("ExtractedDate")||c.get("Date"),[S,$,_]=g.split("."),v=new Date(+_,$-1,+S).getTime(),p=c.get("Text");let M;try{M=JSON.parse(c.get("KeywordMatch").replace(/'/g,'"'))}catch{M=c.get("KeywordMatch").split(/[,;]\s*/)}const k=[];return M.forEach(X=>{const b=p.match(new RegExp(`([^\\.]*${X}[^\\.]*)`,"i"));b&&k.push({kw:X,s:b[1].trim()})}),{date:v,sents:k}}).sort((c,g)=>c.date-g.date);if(!s.length)return;H=((z=s[1])==null?void 0:z.date)||s[0].date,ne=s.at(-1).date,q=ne-H;const o=Math.max(e.width*te,1400),r=Math.max(e.height*te,1800);console.log(o,r);const T=r/2.4*.7,a=800*.7;Y={x:o/2,y:r/2},A={left:0,right:o,top:0,bottom:r},d=e.createGraphics(o,r),d.colorMode(e.HSB),d.textAlign(e.CENTER,e.CENTER),d.textFont("courier"),d.textSize(13*.7),d.background(0),i=e.createGraphics(o,r),i.colorMode(e.HSB),i.textAlign(e.CENTER,e.CENTER),i.textFont("arial"),se=[...new Set(s.map(c=>new Date(c.date).getFullYear()))].sort((c,g)=>c-g).map(c=>{const g=s.filter($=>new Date($.date).getFullYear()===c),S=g.reduce(($,_)=>$+(_.date-H)/q,0)/g.length;return{year:c,avgT:S}});const E=1,t=o-a,m=[...new Set(s.flatMap(c=>c.sents.map(g=>g.kw)))];m.forEach((c,g)=>{let S=Math.round(g*290/Math.max(m.length-1,1)+60)%360,$=0,_=Math.round(g*290/Math.max(m.length-1,1)+60)%360;ee[c]=e.color(S,$,_)}),D=[];const u=T+30*.7;W=e.random([.1,.2,.3,.4,.5,.8,.9,1]),s.forEach(c=>{const g=(c.date-H)/q,S=E+g*(t-E),$=u,_=Math.floor(g*K);c.sents.forEach(({kw:v,s:p})=>{const M=Me(p,v,200),k=Math.ceil(M.length*(G/5.6)),X=e.createVector(e.random(-W,W),1).normalize();D.push({kw:v,nodes:[e.createVector(S,$)],sentence:M,maxSteps:k,grown:0,frameCount:0,startFrame:_,dir0:X,pathLength:0,distArr:[0],lastPlacedCharIndex:-1,finished:!1})})}),C=e.height/A.bottom*1,C=1,R={x:0,y:0},h(0,n.timelineX0=E,n),h(0,n.timelineX1=t,n),h(0,n.yTimeline=u,n),h(0,n.rightDataMargin=a,n),h(0,n.w=o,n),h(0,n.h=r,n),h(0,n.marginY=T,n)},e.draw=()=>{P.clear(),e.frameCount%60===0&&(d.noStroke(),d.fill(0,0,0,.05),d.rect(0,0,d.width,d.height)),D.forEach(t=>t.nodes.forEach(m=>{const u=`${Math.floor(m.x/I)},${Math.floor(m.y/I)}`;P.has(u)||P.set(u,[]),P.get(u).push(m)})),D.forEach(t=>{if(t.finished||F<t.startFrame||(t.frameCount++,t.frameCount%Se!==0||t.grown>=t.maxSteps))return;const m=t.nodes[t.nodes.length-1];let u=t.dir0.copy();const[z,c]=Re(m).split(",").map(Number);for(let v=-1;v<=1;v++)for(let p=-1;p<=1;p++)(P.get(`${z+v},${c+p}`)||[]).forEach(M=>{const k=m.dist(M);k>0&&k<14&&u.add(e.createVector(m.x-M.x,m.y-M.y).normalize().mult(Ee))});u.normalize(),u.y<.2&&(u.y=1),u.normalize();const g=e.noise(m.x*Z,m.y*Z,F*Ce);u.rotate(e.map(g,0,1,-e.QUARTER_PI*.6,e.QUARTER_PI*.6));const S=e.Vector.add(m,e.Vector.mult(u,5.6));S.x=e.constrain(S.x,A.left+10*.7,A.right-10*.7),S.y=e.constrain(S.y,A.top+10*.7,A.bottom-10*.7),t.nodes.push(S),t.grown++;const $=m.dist(S);t.pathLength+=$,t.distArr.push(t.pathLength);let _=t.lastPlacedCharIndex+1;for(;_<t.sentence.length&&(_+.5)*G<t.pathLength;){const v=(_+.5)*G,p=t.distArr.findIndex(M=>M>=v);if(p>0){const M=t.distArr[p-1],k=t.nodes[p-1],X=t.nodes[p],b=(v-M)/X.dist(k),ke=e.lerp(k.x,X.x,b),pe=e.lerp(k.y,X.y,b),$e=e.atan2(X.y-k.y,X.x-k.x),ve=t.sentence[_],Xe=14/2,Ne=_e(t.kw,ve,Xe);d.push(),d.translate(ke,pe),d.rotate($e),d.imageMode(e.CENTER),d.image(Ne,0,-5.6),d.pop(),t.lastPlacedCharIndex=_,_++}else break}t.grown>=t.maxSteps&&(t.finished=!0)}),F++;const s=Math.min(F/K,1),o=n.timelineX0,r=n.timelineX1,T=Y.x,a=o+s*(r-o);!O&&C>=.3&&(R.x=-(a-T)*C,R.y=C),i.clear(),i.stroke(0,0,255),i.strokeWeight(2*.7),i.line(o,n.yTimeline,r,n.yTimeline),i.line(o,n.h,r,n.h),se.forEach(({year:t,avgT:m})=>{const u=o+m*(r-o),z=n.yTimeline-32*.7;i.noStroke(),i.fill(0,0,255),i.textSize(18*.7),i.text(t,u,z);const c=z+22*.7;i.push(),i.stroke(0,0,255),i.strokeWeight(2*.7),i.drawingContext.setLineDash([18*.7,10*.7]),i.line(u,c,u,n.h),i.drawingContext.setLineDash([]),i.pop()});const w=o+s*(r-o);if(i.stroke(0,0,255),i.strokeWeight(3*.7),i.line(o,n.yTimeline-2*.7,w,n.yTimeline-2*.7),D.length&&D.every(t=>t.finished)){Te();return}e.background(0),e.push(),e.translate(e.width/2,e.height/2),e.scale(C),e.translate(R.x,R.y),e.image(d,-Y.x,-Y.y),e.image(i,-Y.x,-Y.y),e.pop(),f?e.frameRate(6):e.frameRate(30),f&&y<Ge&&(e.saveCanvas("frame-"+e.nf(y,4),"png"),y++)};function Re(s){return`${Math.floor(s.x/I)},${Math.floor(s.y/I)}`}function Te(){W=e.random([.1,.2,.3,.4,.5,1,2,3,4,5]),F=0,d.clear(),d.background(0),L.clear(),e.setup()}e.mousePressed=()=>{O=!0,U=e.mouseX,j=e.mouseY},e.mouseReleased=()=>{O=!1},e.mouseDragged=()=>{if(O){const s=(e.mouseX-U)/C,o=(e.mouseY-j)/C;R.x+=s,R.y+=o,U=e.mouseX,j=e.mouseY}},e.mouseWheel=s=>{const o=s.deltaY<0?1.05:.9523809523809523,r=Math.min(F/K,1),T=n.timelineX0+r*(n.timelineX1-n.timelineX0),a=n.yTimeline,w=e.width/2,E=e.height/2,t=w+(T-Y.x+R.x)*C,m=E+(a-Y.y+R.y)*C;return C=e.constrain(C*o,.5,1),R.x=(w-t)/C+R.x,R.y=(E-m)/C+R.y,!1},e.windowResized=()=>{e.resizeCanvas(e.windowWidth,e.windowHeight)}};return J.subscribe(e=>f=e),[n]}class et extends xe{constructor(l){super(),we(this,l,Ke,Ve,me,{})}}export{et as component,Ze as universal};
